# **Adapter** – **Raw Infra × Verifier**  
*If this chapter ends up confusing you, the shortcut is right* [*here*](https://github.com/0x76agabond/chimera-architecture/blob/main/Pattern/10.%20vision.md)

---

I once met a guy who built a `CQRS` system that wrote a giant JSON dump to `ELK` for every single API call.  
**Yes, every call.*  

To **“optimize performance”**, he also kept a cached copy of that file in memory, which meant the server `RAM` was always filled.

If you triggered his API twice per second, the entire service would crash.  
Not slow down, **just crash**.  
I don't know how the story ended, I never met him again.

Watching that system run reminded me of medieval movies where prisoners get beaten until they pass out, then get water poured on them to wake them up and beat them again.  
Except in this story, **the poor prisoner was the server.**

So I make this to **free the poor server** from its circle of suffering. 
May it find a better life in its next deployment.


## **The Pattern**
**Yes, still no misuse, sad*

First, just to be clear, **if you want to call anything outside of you app**, you much have an `Adapter` for it.

And if anyone calls you **as a service (not presentation)** you should also have a `Adapter`.   
( **Oops, we reinvented Hexa!* )

**There is no one-size-fits-all `Adapter`.  
Each type requires its own strategy, but these are thing you should aim for.**

1. You will want the `Adapter` run as light as posible.
2. You probably want to **abuse asynchronous development**.
3. You don’t have to handle everything the moment it touches your server.   
**Just leave it in any kind of storage** then **do the job when your server got resouce**.  
( **Hey! This is the mindset of event sourcing* )
4. A `Adapter` much go with a `Verifier`, `Adapter` got full infra power, `Verifier` make sure **only valid request can reach it**.
5. `Verifier` should validate data flowing both ways: `Adapter` → `Service` and `Service` → `Adapter`.  
( **Be cautious with your little yandere* )
6. `Adapter` must define its own timeout boundary.
7. Retry logic should be placed outside of the `Adapter`.  
(**If your mind jumps to the `Presentation Layer`, you’re a better troller than me.*)
8. You don’t have to use a single library for infra communication.  
If different libs are better for different steps and they’re compatible → mix them.  
( **Hey, we reinvented CQRS!* )
9. Adapter behavior must be consistent.  
If it isn’t, your team should know it!

## **Example**

Ok it time for us to get back and liberating the poor server from suffering.  

**Original bottleneck:**

    Every request → write giant JSON → ELK → cache to RAM → explode.

**Chimera approach:**  

**Adapter receives the request**  
*→ Validate just enough with the Verifier.*

**Drop the raw payload into a lightweight storage (queue / file / caching and more).**  
*→ You will want to abuse asynchronous here.*

**Return immediately**  
*→ Be ready for more.*

**A poor Background worker handles the heavy work**  
*→ You gonna need a Scheduler here*.

**New form:**

    Every request → verify → transform → send to ELK → retry if fail.

→ **As you can see, the server can now run this loop without suffering.**  
**Sometimes it may fail, but it won’t die.**  
**Yes, somehow our poor server got reincarnated as Captain America, it can “do this all day.”*   
**namo amitabha*
## **Benefit**
- Server stops dying because the heavy work moves to background workers.

- `Adapter` stays lightweight, fast, and easy to reason about.

- `Verifier` blocks trash input before it touches infra.

- Async abuse help with **scalability without rewriting** your whole system.

## **Debate**

***Q. You think my setup funny? Am I a joke to you?***  
*A. No. You need help.*

***Q. So I should put the retry logic in the Presentation Layer, right?***  
*A. Hi, It depends on what you're up to.*  
- *If you just want to retry the Adapter, put it in the **Verifier**.*  
- *If the retry follows business logic, put it in the **Service**.*  
- *If the retry depends on multi-step state transitions, put it in the **Flow**.*  
- *If you want to troll both the user **and** your infra team, put it in the **Presentation**.*  
*(Users will happily mash the retry button.)*